# 🎓 小鹅通登录认证配置指南

## 📋 功能概述

AI-Media2Doc 现已支持小鹅通平台的登录认证功能，用户可以通过配置Cookie等认证信息来访问已购买的课程内容，实现视频下载和内容转换。

## ✨ 新增功能特性

### 🔐 认证机制
- **Cookie认证**: 支持通过Cookie访问已购买课程
- **多账户支持**: 可配置不同的APP ID和域名
- **权限验证**: 自动检查课程访问权限
- **会话管理**: 智能处理认证状态

### 🛡️ 安全特性
- **配置加密**: 敏感信息本地存储加密
- **权限检查**: 仅支持已购买内容访问
- **错误处理**: 完善的认证失败处理机制

## 🚀 配置方法

### 方法一：环境变量配置（推荐）

1. **编辑环境变量文件**
   ```bash
   # 编辑 variables.env 文件
   XIAOE_COOKIE=your_xiaoe_cookie_here
   XIAOE_APP_ID=your_xiaoe_app_id_here
   XIAOE_HOST=your_xiaoe_host_here
   ```

2. **重启服务**
   ```bash
   make stop
   make run
   ```

### 方法二：前端界面配置

1. **打开配置界面**
   - 启动AI-Media2Doc应用
   - 在设置页面找到"小鹅通配置"选项

2. **填写认证信息**
   - Cookie: 从浏览器获取的认证Cookie
   - APP ID: 从课程链接提取（可选）
   - API域名: 小鹅通API域名（可选）

3. **测试连接**
   - 点击"测试连接"按钮验证配置
   - 确认认证成功后保存配置

## 📖 详细配置说明

### 🍪 如何获取Cookie

1. **登录小鹅通**
   - 在浏览器中打开小鹅通课程页面
   - 使用您的账号登录

2. **打开开发者工具**
   - 按 `F12` 或右键选择"检查元素"
   - 切换到 `Network`（网络）标签页

3. **获取Cookie**
   - 刷新页面或点击任意链接
   - 在请求列表中选择任意请求
   - 在 `Request Headers` 中找到 `Cookie` 字段
   - 复制完整的Cookie值

4. **Cookie示例**
   ```
   session_id=abc123; user_token=xyz789; _ga=GA1.2.123456789
   ```

### 🆔 如何获取APP ID

1. **从课程链接提取**
   ```
   https://appisb9y2un7034.xet.citv.cn/p/course/column/p_608baa19e4b071a81eb6ebbc
   ```
   其中 `appisb9y2un7034` 就是APP ID

2. **常见格式**
   - `app` + 字母数字组合
   - 例如：`appisb9y2un7034`、`appABC123DEF456`

### 🌐 如何获取API域名

1. **从课程链接提取**
   ```
   https://appisb9y2un7034.xet.citv.cn/...
   ```
   其中 `xet.citv.cn` 就是API域名

2. **常见域名**
   - `xet.citv.cn`
   - `h5.xiaoeknow.com`
   - `xiaoe-tech.com`

## 🔧 使用方法

### 1. 基本使用流程

1. **配置认证信息**
   - 按照上述方法配置Cookie等信息

2. **输入课程链接**
   - 在视频链接输入框中粘贴小鹅通课程链接
   - 支持的链接格式：
     ```
     https://appisb9y2un7034.xet.citv.cn/p/course/column/p_608baa19e4b071a81eb6ebbc
     https://xiaoeknow.com/detail/l_123456789/course_name
     ```

3. **解析和下载**
   - 点击"解析链接"按钮
   - 系统将自动验证权限并下载视频
   - 选择生成风格并开始处理

### 2. 高级功能

- **批量处理**: 支持多个课程链接的批量处理
- **权限检查**: 自动检查课程访问权限
- **错误恢复**: 认证失败时的自动重试机制

## 🐛 故障排除

### 常见问题及解决方案

#### 1. Cookie无效或过期
**症状**: 提示"认证失败"或"Cookie无效"
**解决方案**:
- 重新登录小鹅通获取新的Cookie
- 确保Cookie格式完整，包含所有必要字段
- 检查Cookie是否包含特殊字符需要转义

#### 2. 课程无访问权限
**症状**: 提示"无权限访问"或"需要购买"
**解决方案**:
- 确认已购买该课程
- 检查账号是否正确
- 联系课程提供方确认权限

#### 3. 网络连接问题
**症状**: 请求超时或连接失败
**解决方案**:
- 检查网络连接
- 尝试更换网络环境
- 确认小鹅通服务正常

#### 4. 配置格式错误
**症状**: 配置验证失败
**解决方案**:
- 检查Cookie格式是否正确
- 确认APP ID和域名格式
- 参考配置示例重新填写

### 调试方法

1. **查看日志**
   ```bash
   # 查看后端日志
   docker logs ai-media2doc-backend
   
   # 查看前端控制台
   # 在浏览器中按F12查看Console
   ```

2. **测试认证**
   - 使用前端配置界面的"测试连接"功能
   - 检查认证状态和用户信息

## ⚠️ 注意事项

### 安全提醒
- Cookie包含敏感认证信息，请妥善保管
- 不要在公共场所或不安全的网络环境下配置
- 定期更新Cookie以确保安全性

### 使用规范
- 仅支持已购买课程的访问和下载
- 请遵守小鹅通平台的使用条款和服务协议
- 不得用于商业盗版或侵犯版权的行为
- 建议仅用于个人学习和笔记整理

### 技术限制
- Cookie有时效性，过期后需要重新获取
- 部分课程可能有特殊的访问限制
- 网络环境可能影响访问稳定性

## 📞 技术支持

如果在配置或使用过程中遇到问题，可以：

1. **查看日志**: 检查系统日志获取详细错误信息
2. **重新配置**: 尝试重新获取和配置认证信息
3. **网络检查**: 确认网络连接和小鹅通服务状态
4. **版本更新**: 确保使用最新版本的AI-Media2Doc

## 🔄 更新日志

### v2.1.0 (2025-01-27)
- ✅ 新增小鹅通Cookie认证支持
- ✅ 添加前端配置界面
- ✅ 实现权限验证机制
- ✅ 完善错误处理和用户提示
- ✅ 添加认证测试功能

---

**免责声明**: 本工具仅用于访问用户已购买的课程内容，请遵守相关法律法规和平台使用条款。
